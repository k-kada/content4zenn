---
title: "PythonでSlack APIを使ってPresenceを取得する"
emoji: "👀"
type: "tech" # tech: 技術記事 / idea: アイデア
topics: ["Slack","Python"]
published: false
---

# 概要
決してサボっている人を検知したいのではなく、参考情報として取得したかったのでまとめました。
PresenceというのはSlackのアイコンの右下に出るアクティブとかの表示です。

# 準備編
Slack Appを作成し、対象のワークスペースに対して使用可能な状態にしておく。
必要なスコープは`users:read`となります。

# 開発環境
Pythonに`slack_sdk`をインストールします。

```
pip install slack_sdk
```

今回試したのは下記環境です。
Python:
slack_sdk: 3.5.0

# 実装
とりあえず下記の感じでコード書いたら動きます。

```python
import os
from slack_sdk import WebClient

token = os.environ.get("SLACK_BOT_TOKEN")
client = WebClient(token=token)

response = client.users_list()
users = response["members"]
awayList = []

for user in users:
    if user['is_bot'] == False and 'is_restricted' in user:
        if user['is_restricted'] == False and user['real_name'] != 'Slackbot':
            userPresence = client.users_getPresence(user=user['id'])
            if userPresence['presence'] == 'away':
                awayList.append([strTimeStamp, user['id'], user['name'], user['real_name']])
```

この実装が推奨されるのかはちょっとわからないので、頻繁に取得する場合は自己責任でお願いします。
ユーザー毎に`getPresence`しているので総ユーザー数が多いと実行に時間がかかります。
