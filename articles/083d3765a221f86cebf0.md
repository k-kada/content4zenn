---
title: "Pythonã§Slack APIã‚’ä½¿ã£ã¦Presenceã‚’å–å¾—ã™ã‚‹"
emoji: "ğŸ‘€"
type: "tech" # tech: æŠ€è¡“è¨˜äº‹ / idea: ã‚¢ã‚¤ãƒ‡ã‚¢
topics: ["Slack","Python"]
published: false
---

# æ¦‚è¦
æ±ºã—ã¦ã‚µãƒœã£ã¦ã„ã‚‹äººã‚’æ¤œçŸ¥ã—ãŸã„ã®ã§ã¯ãªãã€å‚è€ƒæƒ…å ±ã¨ã—ã¦å–å¾—ã—ãŸã‹ã£ãŸã®ã§ã¾ã¨ã‚ã¾ã—ãŸã€‚
Presenceã¨ã„ã†ã®ã¯Slackã®ã‚¢ã‚¤ã‚³ãƒ³ã®å³ä¸‹ã«å‡ºã‚‹ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã¨ã‹ã®è¡¨ç¤ºã§ã™ã€‚

# æº–å‚™ç·¨
Slack Appã‚’ä½œæˆã—ã€å¯¾è±¡ã®ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹ã«å¯¾ã—ã¦ä½¿ç”¨å¯èƒ½ãªçŠ¶æ…‹ã«ã—ã¦ãŠãã€‚
å¿…è¦ãªã‚¹ã‚³ãƒ¼ãƒ—ã¯`users:read`ã¨ãªã‚Šã¾ã™ã€‚

# é–‹ç™ºç’°å¢ƒ
Pythonã«`slack_sdk`ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã—ã¾ã™ã€‚

```
pip install slack_sdk
```

ä»Šå›è©¦ã—ãŸã®ã¯ä¸‹è¨˜ç’°å¢ƒã§ã™ã€‚
Python:
slack_sdk: 3.5.0

# å®Ÿè£…
ã¨ã‚Šã‚ãˆãšä¸‹è¨˜ã®æ„Ÿã˜ã§ã‚³ãƒ¼ãƒ‰æ›¸ã„ãŸã‚‰å‹•ãã¾ã™ã€‚

```python
import os
from slack_sdk import WebClient

token = os.environ.get("SLACK_BOT_TOKEN")
client = WebClient(token=token)

response = client.users_list()
users = response["members"]
awayList = []

for user in users:
    if user['is_bot'] == False and 'is_restricted' in user:
        if user['is_restricted'] == False and user['real_name'] != 'Slackbot':
            userPresence = client.users_getPresence(user=user['id'])
            if userPresence['presence'] == 'away':
                awayList.append([strTimeStamp, user['id'], user['name'], user['real_name']])
```

ã“ã®å®Ÿè£…ãŒæ¨å¥¨ã•ã‚Œã‚‹ã®ã‹ã¯ã¡ã‚‡ã£ã¨ã‚ã‹ã‚‰ãªã„ã®ã§ã€é »ç¹ã«å–å¾—ã™ã‚‹å ´åˆã¯è‡ªå·±è²¬ä»»ã§ãŠé¡˜ã„ã—ã¾ã™ã€‚
ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¯ã«`getPresence`ã—ã¦ã„ã‚‹ã®ã§ç·ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°ãŒå¤šã„ã¨å®Ÿè¡Œã«æ™‚é–“ãŒã‹ã‹ã‚Šã¾ã™ã€‚
